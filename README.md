# Текстовые утилиты

Все утилиты выполнены в виде функций единственного класса `tpl`. Практически каждая функция может 
быть вызвана как в статическом, так и в классическом виде. Вызов статического 
синонима, как правило, более компактен, однако в классическом виде можно настроить 
формат вывода более гибко. И с наследованием все значительно более правильно. Впрочем, обычно это не нужно.

Несомненной пользой класса является тот факт, что класс одинаково хорошо работает как в обычном, 
так и битриксовском серверном окружении. 

## Использование

    use Ksnk\text\tpl;
    $data=[
        'promo'=>'СКОРОЛЕТО',
        'first_name'=>'Вагоноуважатый',
        'discountrub'=>250,
        'prop'=>tpl::prop(2345,tpl::RUB),
        'date'=>'now'
        ];
    echo tpl::text('Глубокоуважаемый{first_name?{ first_name}{ second_name}}!
    При оформлении заказа от {date|d}, Вам предоставлена скидка {discountrub?{discountrub}₽:{discount}%} по промокоду `{promo}`
    Общая сумма заказа составляет: {prop}
    ',$data);
    /*
    Глубокоуважаемый Вагоноуважатый!
        При оформлении заказа от 25 октября, Вам предоставлена скидка 250₽ по промокоду `СКОРОЛЕТО`
        Общая сумма заказа составляет: две тысячи триста сорок пять рублей
    */

    
## установка

    composer require ksnk/text
    
По сути - там один файл, в случае серьезной нужды - поковыряйтесь в репозитории, скопируйте его 
себе и делайте с ним что угодно. Но не дай БГ так оголодать ))) композер - это действительно удобно.           

## Вывод числа прописью. tpl::prop($number, $valute = array|string|FALSE, $kop = FALSE)

Первый параметр - число, если число не целое, целая часть выводится словами, вторая цифрами. 
Подпись к обоим частям - второй параметр. `"рубл|ь|я|ей;+копе|йка|йки|ек";`
Третий параметр говорит - можно ли опускать вывод `00 коп`.

При выводе числа учитывается склонение. Женский род помечается ведущим символом `+`, 
при указании второго параметра функции

    $number=101;
    //'сто один баран на поле', склонение в мужском роде - один-два
    tpl::text('{prop} на поле', [
        'prop'=>tpl::prop($number,"баран||а|ов")]);
    );
    // проверка склонения в женском роде одна-две вместо один-два
    //'сто одна овца на поле',
    tpl::text('{prop} на поле', [
        'prop'=>tpl::prop($number,"+овц|а|ы|ец")]) ;
        
Классический вывод цены с копейками        

    $tpl=new tpl();
    echo $tpl->num2str(23456.45, tpl::RUB, true);
    // двадцать три тысячи четыреста пятьдесят шесть рублей 45 копеек
    
    echo tpl:prop(23456.45, tpl::RUB, true);
 
## Вывод русской даты. tpl::rusd($time,$format)

К удивлению, в PHP до сих пор из коробки отсутствует возможность вывода даты по-русски, с названиями в 
родительном падеже. Только в именительном. Как же так?

    // так советуют писать тру ПХПшники
    setlocale(LC_ALL, 'ru_RU', 'ru_RU.UTF-8', 'ru', 'russian');
    echo strftime("%B %d, %Y", time()).PHP_EOL;
    // Октябрь 25, 2022

    // Так хочет бухгалтер
    $tpl->toRusDate(time()); // 25 октября, 2022 г.
    tpl::rusd(time(), "j F"); // 25 октября.
    
Используется формат даты для обычного вывода даты по английски. Можно таймстамп, можно строковое 
значение из базы, которое понимается оператором strtotime. Если требуется умное преобразование дат 
- лучше сделать это вне шаблонизатора и передать уже нужный таймстамп.  

## plural. tpl::pl

Окончания для числительных. Параметр в строковом виде, `ОДИН, ТРИ, ПЯТЬ`. 
Для статического способа вызова более компактная форма вызова - одна строка параметров, 
разделенных `|`.

    echo $tpl->plural(25, 'копейка', 'копейки', 'копеек');
    echo 25.' копе'.tpl::pl(25,'йка|йки|ек');
    
Впрочем, самостоятельного применения практически не имеет, обычно в составе шаблона. Опять же, 
формат параметров в строке чуть-чуть отличается от используемого функцией `text`, что делает 
явное использование формы, скорее, вредной практикой.

## tpl::text

Форматированный вывод с подстановкой значений. Имеются операторы-подстановки - переменная в фигурных 
скобках. В конце переменной могут находиться модификаторы, отделяемые символом `|`. Пример `{date|t}`
Ведущие пробелы перед переменной в подстановке выводятся вместе со значением подстановки, 
если значение не пусто.
Кроме подстановок имеются логические тернарные операторы.

    $data=[
        'first_name'=>'Вассисуалий',
        'second_name'=>'Лоханкин',
        'joined'=>'2022-10-15'
    ];
    
    echo tpl::text('Уважаемый {first_name}{ second_name}!', $data);
    
В случае, если второй параметр отсутствует в данных, восклицательный знак 
не отделяется пробелом. Это позволяет генерировать корректные с точки зрения лишних 
пробелов конструкции - `Уважаемый Вассисуалий!` `Уважаемый!` `Уважаемый Вассисуалий Лоханкин!`

    echo tpl::text('Уважаемый {joined?подписчик:посетитель}!', $data);
  
Минимальная логика, в зависимости от пустоты  `joined` выводится первый или второй 
операнд логического оператора. Внутри операнда могут находиться подстановки.

    echo tpl::text('Уважаемый {first_name?:посетитель}!', $data);
    
Условный оператор в виде  `?:` имеет несколько отличающуюся от очевидной, логику вывода. 
Если параметр не пуст, выводится он, если пуст - выводится значение по умолчанию. 
Фактически, является сокращением 
`{first_name?{first_name}:посетитель}`
   
    $data['number]=23;
    echo tpl::text('{number} баран{||а|ов} на поле!', $data);
    // 23 барана на поле
    
Окончание числительных. Модификатор, в котором присутствует 3 символа `|`.
 Можно использовать в 2-х формах, полная -  `{order_num||а|ов}` и сокращенная `{||а|ов}`, 
 в последнем случае числовое значение берется из последнего подмененного шаблона. 
   
Список модификаторов
- `окончание числительных`
- `|t` - время выводится в виде `25 апреля 2022 г. в 10:00`
- `|d` - время выводится в виде `25 апреля` или `25 апреля 2020 г.`, 
если год даты не совпадает с текущим.
- `|d|j F Y г. в H\:i` - время с явным указанием формата вывода. Формат 
выедается до закрывающих скобок. Обратите внимание, что модификатору `t` нет возможности указать формат
Символы `:?\{}` которые встречаются внутри описателя и должны выводится в 
форматированной дате, обязаны быть заслешены.

## tpl::utext

Отличается от text тем, что используются двойные фигурные скобки вместо одинарных 
для определения границ подстановок и логических операторов. В остальном логика и операторы шаблонов
одинаковы.
В определенной степени, шаблоны включают в себя шаблонный язык Unisender. 
Во всяком случае - я обрабатываю шаблоны, скачанные оттуда именно в этом  режиме. 
Несколько большие, по сравнению с Unisender возможности не конфликтуют.
 
## tpl::sql

Является экспериментальным режимом работы шаблонизатора. Позволяет готовить 
sql запросы в достаточно экзотических условиях. Не рекомендуется
для широкого применения. Пользой этого режима является единообразие 
sql вне зависимости от используемых CMS, что позволяет писать более 
переносимые с системы на систему модули.